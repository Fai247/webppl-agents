var start = { 
  loc : [3,0],
  dead : false,
  digest : 2, 
  timeLeft : 13
};

var donutUtility = makeDonutUtility(2, {
    'Donut N' : [10, -10],
    'Donut S' : [10, -10],
    'Veg'   : [-10, 20],
    'Noodle': [0, 0]
});

var world = makeDonutWorld2({ big : true, noReverse : true});
var actual_agent = makeHyperbolicDiscounter(
    { utility : donutUtility,
      alpha : 500, 
      discount : 1, 
      sophisticatedOrNaive  : 'naive' 
    }, world);
var observed1 = simulate(start, world, actual_agent, start.timeLeft, 'both');
var observed2 = simulate(update(start, { loc : [5,3] }), world, actual_agent, start.timeLeft, 'both');

var posterior = Enumerate(function () {
  var discount = uniformDraw([0,1,2]);
  var type = uniformDraw(['sophisticated', 'naive']);
  var alpha = uniformDraw([1, 10, 100]);
  var Udonut1 = uniformDraw([-10,  10, 20]);
  var Udonut2 = uniformDraw([-10,  10, 20]);
  var Uveg1   = -10;
  var Uveg2   = 20;

  var donutUtility = makeDonutUtility(2, {
      'Donut N' : [Udonut1, Udonut2],
      'Donut S' : [Udonut1, Udonut2],
      'Veg'     : [Uveg1, Uveg2],
      'Noodle'  : [0, 0]
  });

  var agent = makeHyperbolicDiscounter(
      { utility   : donutUtility,
        alpha     : alpha, 
        discount  : discount, 
        sophisticatedOrNaive  : type,
      }, world);
  var agentAction = agent.agent;

  map(function (stateAction) {
    var state   = stateAction[0];
    var action  = stateAction[1];

    factor(agentAction(state, 0).score([], action)) ; 
  }, observed1);

  map(function (stateAction) {
    var state   = stateAction[0];
    var action  = stateAction[1];

    factor(agentAction(state, 0).score([], action)) ; 
  }, observed2);

  return { 
    type : type, 
    discount : discount,
    alpha : alpha,
    Udonut1 : Udonut1, 
    Udonut2 : Udonut2
         };
});

viz.print(posterior);
