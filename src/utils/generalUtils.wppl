var GridWorld = webpplAgents; // reference to the exports of gridworld-viz.js

// for non-browser use of viz functions
// var viz = webpplAgents;
// var print = function(x){
//   return console.log(JSON.stringify(x));
// };




// General utilities
var update = function(base, ext){
  return _.extend({}, base, ext);
};

var hasProperties = function(object, listProperties){
  assert.ok( _.isObject(object) && _.isArray(listProperties), 'fail hasProperties');
  return _.all( map( 
    function(property){ 
      return _.has(object, property);
    }, listProperties));
};

var ash = function(){assert.ok(0,'assert halt');};

var downToOne = function(n){
  if (n==0){return [];}
  else {return [n].concat(downToOne(n-1));}
};

var arraysEqual = function(xs, ys){
  return JSON.stringify(xs) === JSON.stringify(ys);
};

var argMax = function(f, ar){
  return maxWith(f, ar)[0]
};



// Helpers for displaying Dists
var printDist = function(x,k) {
  var distValues = sort(x.support(), undefined, function(v){return -x.score(v);});
  var distValues = typeof(k)=='undefined' ? distValues : distValues.slice(0,k);
  map(
    function(v){
      var prob = Math.exp(x.score(v));
      if (prob > 0.0){
        console.log(JSON.stringify(v) + ': ' + prob.toFixed(5));
      }
    },
    distValues);
};

var printTopK = function(dist,k){
  var distValues = sort(dist.support(), undefined, function(v){return -dist.score(v);});
  map(
    function(v){
      var prob = Math.exp(dist.score(v));
      if (prob > 0.0){
        console.log(JSON.stringify(v) + ': ' + prob.toFixed(5));
      }
    },
    distValues.slice(0,k));
};


var getMarginal = function(dist,key){
  return Infer({ method: 'enumerate' }, function(){
    return sample(dist)[key];
  });
};

var getMarginalObject = function(dist,key){
  return Infer({ method: 'enumerate' }, function(){
    var s = sample(dist);
    var keys = _.keys(s);
    var omitKeys = filter(function(el){
      return el !== key;}, keys);
    return _.omit(s,omitKeys);
  });
};

// Helper for displaying marginals of array of keys
var displayMarginals = function(dist, keys){
  map( function(key){
    console.log('\n Marginal for : ', key);
    printDist(getMarginal(dist, key) );
  }, keys);
};


